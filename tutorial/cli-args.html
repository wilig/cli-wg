<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parsing command line arguments - Command Line Applications in Rust</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="src/special-content.css">
        

        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="index.html">Getting started</a></li><li><a href="tutorial/index.html"><strong aria-hidden="true">1.</strong> A command line app in 15 minutes</a></li><li><ol class="section"><li><a href="tutorial/setup.html"><strong aria-hidden="true">1.1.</strong> Project setup</a></li><li><a href="tutorial/cli-args.html" class="active"><strong aria-hidden="true">1.2.</strong> Parsing command line arguments</a></li><li><a href="tutorial/impl-draft.html"><strong aria-hidden="true">1.3.</strong> First implementation</a></li><li><a href="tutorial/errors.html"><strong aria-hidden="true">1.4.</strong> Nicer error reporting</a></li><li><a href="tutorial/output.html"><strong aria-hidden="true">1.5.</strong> Output for humans and machines</a></li><li><a href="tutorial/testing.html"><strong aria-hidden="true">1.6.</strong> Testing</a></li><li><a href="tutorial/packaging.html"><strong aria-hidden="true">1.7.</strong> Packaging and documentation</a></li></ol></li><li><a href="in-depth/index.html"><strong aria-hidden="true">2.</strong> In-depth topics</a></li><li><ol class="section"><li><a href="in-depth/signals.html"><strong aria-hidden="true">2.1.</strong> Signal handling</a></li><li><a href="in-depth/config-files.html"><strong aria-hidden="true">2.2.</strong> Using config files</a></li><li><a href="in-depth/exit-code.html"><strong aria-hidden="true">2.3.</strong> Exit codes</a></li><li><a href="in-depth/human-communication.html"><strong aria-hidden="true">2.4.</strong> Communicating with humans</a></li><li><a href="in-depth/machine-communication.html"><strong aria-hidden="true">2.5.</strong> Communicating with machines</a></li><li><a href="in-depth/docs.html"><strong aria-hidden="true">2.6.</strong> Rendering documentation for you CLI apps</a></li><li><a href="in-depth/packaging-distribution.html"><strong aria-hidden="true">2.7.</strong> Packaging apps and distributing them for different platforms</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Command Line Applications in Rust</h1> 

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="tutorial/cli-args.html#parsing-command-line-arguments" id="parsing-command-line-arguments"><h1>Parsing command line arguments</h1></a>
<p>A typical invocation of our CLI tool will look like this:
<code>grrs foobar test.txt</code>.
We expect our program to look at <code>test.txt</code>
and print out the lines that contain <code>foobar</code>.
But how do we get these two values?</p>
<p>The text after the name of the program is often called
the “command line arguments”,
or “command line flags”
(especially when they look like <code>--this</code>).
Internally, the operating system usually represents them
as a list of strings --
roughly speaking, the get separated by spaces.
There are many ways to think about these arguments,
and how to parse them
into something more easy to work with.
You will also need to tell the users of your program
which arguments they need to give
and in which format they are expected.</p>
<a class="header" href="tutorial/cli-args.html#cli-arguments-as-data-type" id="cli-arguments-as-data-type"><h2>CLI Arguments as data type</h2></a>
<p>Instead of thinking about them as a bunch of text,
it often pays off to think of CLI arguments as a custom data type
that represents the inputs to your program.</p>
<p>Look at <code>grrs foobar test.txt</code>:
There are two arguments,
first the <code>pattern</code> (the string to look for),
and then the <code>path</code> (the file to look in).</p>
<p>What more can we say about them?
Well, for a start, both are required.
We haven’t talked about any default values,
so we expect our users to always provide two values.
Further more, we can say a bit about their types:
The pattern is expected to be a string,
while the second argument is expect to be path to a file.</p>
<p>In Rust, it is very common to structure programs around the data they deal with
so this way of looking at CLI arguments fits very well.
Let’s start with this:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
#[derive(Debug)]
struct Cli {
    pattern: String,
    path: std::path::PathBuf,
}
#}</code></pre></pre>
<p>This defines a new structure (a <a href="https://doc.rust-lang.org/1.27.2/book/second-edition/ch05-00-structs.html"><code>struct</code></a>)
that has two fields to store data in: <code>pattern</code>, and <code>path</code>.</p>
<aside>
<p><strong>Aside:</strong>
<a href="https://doc.rust-lang.org/1.27.2/std/path/struct.PathBuf.html"><code>PathBuf</code></a> is like a <a href="https://doc.rust-lang.org/1.27.2/std/string/struct.String.html"><code>String</code></a> but for file system paths that works cross-platform.</p>
</aside>
<p>Now, we still need to get the actual arguments our program got into this form.
One option would be manually parse the list of strings we get from the operating system
and build the structure ourselves.
It would looks something like this:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let pattern = std::env::args().nth(1).expect(&quot;no pattern given&quot;);
let path = std::env::args().nth(2).expect(&quot;no path given&quot;);
let args = Cli {
    pattern: pattern,
    path: std::path::PathBuf::from(path),
};
#}</code></pre></pre>
<p>This works, but it’s not very convenient.
How would you deal with the requirement to support
<code>--pattern=&quot;foo&quot;</code> or <code>--pattern &quot;foo&quot;</code>?
How would you implement <code>--help</code>?</p>
<a class="header" href="tutorial/cli-args.html#parsing-cli-arguments-with-clap" id="parsing-cli-arguments-with-clap"><h2>Parsing CLI Arguments with Clap</h2></a>
<p>A much nicer way is to use one of the many available libraries.
As you can see in the <code>src/main.rs</code> file,
our templates already contains some code using <code>clap</code>,
and in particular uses it’s “derive” feature.
This is quite nice:
All we have to do is annotate a struct
and it’ll generate the code that parses the arguments into the fields.
Let’s add our fields to the <code>Cli</code> struct in the template
and also write some documentation comments along the way.
It’ll look like this:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
/// Search for a pattern in a file and display the lines that contain it.
#[derive(Clap)]
struct Cli {
    /// The pattern to look for
    pattern: String,
    /// The path to the file to read
    path: std::path::PathBuf,
}
#}</code></pre></pre>
<aside class="todo">
<p><strong>TODO:</strong>
Ensure this works with clap3.
<a href="https://github.com/rust-lang-nursery/cli-wg/issues/64">Issue #64</a></p>
</aside>
<p>Right below the <code>Cli</code> struct our template contains its <code>main</code> function.
When the program starts, it will call this function.
The first line is:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
let args = Cli::from_args();
#}</code></pre></pre>
<p>This will try to parse the arguments into our <code>Cli</code> struct.</p>
<p>But what if that fails?
That’s the beauty of this approach:
Clap knows which fields to expect,
and what their expected format is.
It can automatically generate a nice <code>--help</code> message,
as well a give great errors
to suggest you pass <code>--output</code> when you wrote <code>--putput</code>.</p>
<aside class="note">
<p><strong>Note:</strong>
The <code>from_args</code> method is meant to be used in your <code>main</code> function.
When it fails,
it will print out an error or help message and exit the program.
Don’t use it in other places!</p>
</aside>
<a class="header" href="tutorial/cli-args.html#this-is-what-it-may-look-like" id="this-is-what-it-may-look-like"><h2>This is what it may look like</h2></a>
<p><img src="./tutorial/cli-args.svg" alt="" /></p>
<aside class="todo">
<p><strong>TODO:</strong>
Use clap 3!
<a href="https://github.com/rust-lang-nursery/cli-wg/issues/64">Issue #64</a></p>
</aside>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="tutorial/setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="tutorial/impl-draft.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="tutorial/setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="tutorial/impl-draft.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
